{% extends "base.html" %}
{% block title %}Monitoring Dashboard{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Monitoring Dashboard</h1>
  <div class="row g-4">
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="card-subtitle text-muted">Health</h6>
          <h3 id="health-status" class="mt-2">--</h3>
          <p class="mb-1 small text-muted">Ops: <span id="health-ops">0</span></p>
          <p class="mb-0 small text-muted">Errors: <span id="health-errors">0</span></p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="card-subtitle text-muted">Cache</h6>
          <h3 id="cache-enabled" class="mt-2">--</h3>
          <p class="mb-1 small text-muted">Hit Rate: <span id="cache-hit-rate">--</span></p>
          <p class="mb-0 small text-muted">Memory: <span id="cache-memory">--</span></p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="card-subtitle text-muted">Throughput</h6>
          <h3 id="ops-total" class="mt-2">0</h3>
          <p class="mb-1 small text-muted">Success Rate: <span id="success-rate">--</span></p>
          <p class="mb-0 small text-muted">Tracked Ops: <span id="ops-tracked">--</span></p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="card-subtitle text-muted">Actions</h6>
          <button id="btn-refresh" class="btn btn-primary btn-sm w-100 mb-2">Refresh Now</button>
          <button id="btn-reset-metrics" class="btn btn-outline-danger btn-sm w-100">Reset Metrics</button>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-lg-8 mb-4">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>Operation Durations (ms)</span>
          <select id="operation-select" class="form-select form-select-sm w-auto"></select>
        </div>
        <div class="card-body">
          <canvas id="chart-operation" height="140"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-header">Cache Hit vs Miss</div>
        <div class="card-body">
          <canvas id="chart-cache" height="140"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mt-2">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Operations Summary</span>
      <small class="text-muted" id="last-updated">Last update: --</small>
    </div>
    <div class="table-responsive">
      <table class="table table-sm table-striped mb-0" id="ops-table">
        <thead class="table-light">
          <tr>
            <th>Operation</th>
            <th>Count</th>
            <th>Success</th>
            <th>Errors</th>
            <th>Success %</th>
            <th>Avg (ms)</th>
            <th>Min (ms)</th>
            <th>Max (ms)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="/static/js/dashboard.js"></script>
{% endblock %}
