{% extends 'base.html' %}

{% block content %}
<div class="max-w-content mx-auto py-8 px-4">
  <h2 class="text-2xl font-bold text-primary mb-6">Injecter un message (HL7 / FHIR)</h2>
  {% if error %}
    <div class="p-4 bg-red-50 border border-red-300 rounded-xl flex items-center gap-3 mb-4 animate-fadeIn">
      <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span class="text-red-700">{{ error }}</span>
    </div>
  {% endif %}

  <form method="post" class="bg-white rounded-xl border border-slate-200 shadow-sm p-8 max-w-2xl mx-auto">
    <div class="grid gap-6 md:grid-cols-2">
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1">Type de message</label>
        <select name="kind" class="block w-full rounded border px-2 py-2 focus:ring-primary focus:border-primary">
          <option value="MLLP">MLLP (HL7 v2)</option>
          <option value="FHIR">FHIR (JSON)</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1">Endpoint cible (optionnel)</label>
        <select name="endpoint_id" class="block w-full rounded border px-2 py-2 focus:ring-primary focus:border-primary">
          <option value="">-- aucun --</option>
          {% for e in endpoints %}
            <option value="{{ e.id }}">{{ e.name }} ({{ e.kind }})</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="mt-6">
      <label class="block text-sm font-medium text-slate-700 mb-1">Payload</label>
      <textarea name="payload" rows="10" class="block w-full rounded border px-3 py-2 font-mono focus:ring-primary focus:border-primary">MSH|^~\&|...</textarea>
    </div>
    <div class="mt-8 flex gap-4 justify-end">
      <button type="submit" class="px-6 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-blue-700 transition">Envoyer</button>
      <a href="/messages" class="text-sm text-slate-600 hover:underline">Retour</a>
    </div>
  </form>
  <div class="mt-8 text-sm text-slate-500">
    Astuce : pour simuler un MLLP entrant, choisissez un endpoint de type MLLP. Le message sera traité par le pipeline d'entrée (PID/PV1/Z99...).
  </div>
</div>
{% endblock %}
